<div class="container py-5">
    <h1 class="mb-5">ğŸ”  ãƒ†ã‚­ã‚¹ãƒˆè¡¨è¨˜å¤‰æ›ãƒ„ãƒ¼ãƒ«</h1>
    
    <div class="p-4 mb-5 bg-light rounded-3 shadow-sm">
        <h2 class="mb-4 fs-4">è¡¨è¨˜å½¢å¼ å¤‰æ›</h2>
        <div id="textFormResult" class="alert mt-3" style="display:none;"></div>
        
        <form id="textForm" onsubmit="handleTextConversion(event)">
            <div class="mb-3">
                <label for="textInput" class="form-label">å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ</label>
                <textarea id="textInput" name="textInput" class="form-control" rows="8" placeholder="å…¨è§’ãƒ»åŠè§’ãƒ»ã‹ãªãƒ»è‹±æ•°å­—ãŒæ··åœ¨ã—ãŸãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚" required></textarea>
            </div>
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="textMode" class="form-label">å¤‰æ›ãƒ¢ãƒ¼ãƒ‰</label>
                    <select id="textMode" name="textMode" class="form-select" required>
                        <option value="toHalfWidth">å…¨è§’ â†’ åŠè§’</option>
                        <option value="toFullWidth">åŠè§’ â†’ å…¨è§’</option>
                        <option value="toHiragana">ã‚«ã‚¿ã‚«ãƒŠ â†’ ã²ã‚‰ãŒãª</option>
                        <option value="toKatakana">ã²ã‚‰ãŒãª â†’ ã‚«ã‚¿ã‚«ãƒŠ</option>
                        <option value="toLower">å¤§æ–‡å­— â†’ å°æ–‡å­—</option>
                        <option value="toUpper">å°æ–‡å­— â†’ å¤§æ–‡å­—</option>
                        <option value="htmlEscape">HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—</option>
                        <option value="htmlUnescape">HTMLã‚¢ãƒ³ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—</option>
                    </select>
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary me-2">å®Ÿè¡Œ</button>
            <button type="button" class="btn btn-secondary" onclick="clearTextResults('textForm', 'textInput', 'textResult')">ã‚¯ãƒªã‚¢</button>
        </form>

        <div class="mt-5">
            <label for="textResult" class="form-label">çµæœ</label>
            <textarea id="textResult" name="textResult" class="form-control" rows="8" readonly placeholder="ã“ã“ã«å¤‰æ›çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚"></textarea>
        </div>
    </div>
</div>

<script>
/**
 * ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£: çµæœ/ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
 */
function displayResult(formId, message, isError) {
    const resultDiv = document.getElementById(formId + 'Result');
    if (!resultDiv) return;

    resultDiv.innerHTML = message;
    resultDiv.className = isError 
        ? 'alert alert-danger mt-3' 
        : 'alert alert-success mt-3';
    resultDiv.style.display = 'block';
}

/**
 * ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£: ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ã®å‡¦ç†
 */
function clearTextResults(formId, inputId, resultId) {
    document.getElementById(inputId).value = '';
    document.getElementById(resultId).value = '';
    const resultDiv = document.getElementById(formId + 'Result');
    if (resultDiv) {
        resultDiv.style.display = 'none';
    }
}

/**
 * å…¨è§’ãƒ»åŠè§’ãƒ»ã‹ãªå¤‰æ›ã®ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯
 * @param {string} str - å…¥åŠ›æ–‡å­—åˆ—
 * @param {string} mode - å¤‰æ›ãƒ¢ãƒ¼ãƒ‰ ('a':å…¨è§’â†’åŠè§’, 'A':åŠè§’â†’å…¨è§’, 'h':ã‚«ã‚¿ã‚«ãƒŠâ†’ã²ã‚‰ãŒãª, 'H':ã²ã‚‰ãŒãªâ†’ã‚«ã‚¿ã‚«ãƒŠ)
 */
function convertString(str, mode) {
    const hankaku = "ï½±ï½²ï½³ï½´ï½µï½¶ï½·ï½¸ï½¹ï½ºï½»ï½¼ï½½ï½¾ï½¿ï¾€ï¾ï¾‚ï¾ƒï¾„ï¾…ï¾†ï¾‡ï¾ˆï¾‰ï¾Šï¾‹ï¾Œï¾ï¾ï¾ï¾ï¾‘ï¾’ï¾“ï¾”ï¾•ï¾–ï¾—ï¾˜ï¾™ï¾šï¾›ï¾œï½¦ï¾ï½§ï½¨ï½©ï½ªï½«ï½¯ï½¬ï½­ï½®ï½°ï½¡ï½¤ï½¥ï¾ï¾Ÿ";
    const zenkaku = "ã‚¢ã‚¤ã‚¦ã‚¨ã‚ªã‚«ã‚­ã‚¯ã‚±ã‚³ã‚µã‚·ãƒ¼ã‚¹ã‚»ã‚½ã‚¿ãƒãƒ„ãƒ†ãƒˆãƒŠãƒ‹ãƒŒãƒãƒãƒãƒ’ãƒ•ãƒ˜ãƒ›ãƒãƒŸãƒ ãƒ¡ãƒ¢ãƒ¤ãƒ¦ãƒ¨ãƒ©ãƒªãƒ«ãƒ¬ãƒ­ãƒ¯ãƒ²ãƒ³ã‚¡ã‚£ã‚¥ã‚§ã‚©ãƒƒãƒ£ãƒ¥ãƒ§ãƒ¼ã€‚ã€ãƒ»ã€Œã€ã‚›ã‚œ";
    let result = '';

    for (let i = 0; i < str.length; i++) {
        let char = str.charAt(i);
        
        if (mode === 'toHalfWidth' || mode === 'toFullWidth') {
            // å…¨è§’ãƒ»åŠè§’å¤‰æ›
            let index = -1;
            if (mode === 'toHalfWidth') { // å…¨è§’â†’åŠè§’
                index = zenkaku.indexOf(char);
                if (index !== -1) {
                    char = hankaku.charAt(index);
                }
            } else { // åŠè§’â†’å…¨è§’
                index = hankaku.indexOf(char);
                if (index !== -1) {
                    char = zenkaku.charAt(index);
                }
            }
        } else if (mode === 'toHiragana') {
            // ã‚«ã‚¿ã‚«ãƒŠâ†’ã²ã‚‰ãŒãª
            char = char.replace(/[\u30a1-\u30f6]/g, function(match) {
                return String.fromCharCode(match.charCodeAt(0) - 0x60);
            });
        } else if (mode === 'toKatakana') {
            // ã²ã‚‰ãŒãªâ†’ã‚«ã‚¿ã‚«ãƒŠ
            char = char.replace(/[\u3041-\u3096]/g, function(match) {
                return String.fromCharCode(match.charCodeAt(0) + 0x60);
            });
        }

        // è‹±æ•°å­—ãƒ»è¨˜å·ã®å…¨è§’åŠè§’å¤‰æ›ï¼ˆç°¡æ˜“ï¼‰
        if (mode === 'toHalfWidth') {
            char = char.replace(/[ï¼¡-ï¼ºï½-ï½šï¼-ï¼™]/g, function(s) {
                return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
            });
        } else if (mode === 'toFullWidth') {
             char = char.replace(/[A-Za-z0-9]/g, function(s) {
                return String.fromCharCode(s.charCodeAt(0) + 0xFEE0);
            });
        }
        
        result += char;
    }
    return result;
}

// =========================================================
// ãƒ¡ã‚¤ãƒ³ã®å¤‰æ›ãƒãƒ³ãƒ‰ãƒ©
// =========================================================
function handleTextConversion(event) {
    event.preventDefault(); 
    const formId = 'textForm';
    const form = document.getElementById(formId);
    
    const input = form.elements['textInput'].value;
    const mode = form.elements['textMode'].value;
    const resultTextarea = document.getElementById('textResult');
    let result = '';
    let successMessage = '';

    if (!input) {
        displayResult(formId, 'å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', true);
        resultTextarea.value = '';
        return;
    }

    try {
        if (mode === 'toHalfWidth' || mode === 'toFullWidth' || 
            mode === 'toHiragana' || mode === 'toKatakana') {
            // å…¨è§’ãƒ»åŠè§’ãƒ»ã‹ãªå¤‰æ›
            result = convertString(input, mode);
            successMessage = 'è¡¨è¨˜å½¢å¼ã®å¤‰æ›ãŒå®Œäº†ã—ã¾ã—ãŸã€‚';
        } else if (mode === 'toLower') {
            // å°æ–‡å­—åŒ–
            result = input.toLowerCase();
            successMessage = 'å°æ–‡å­—ã¸ã®å¤‰æ›ãŒå®Œäº†ã—ã¾ã—ãŸã€‚';
        } else if (mode === 'toUpper') {
            // å¤§æ–‡å­—åŒ–
            result = input.toUpperCase();
            successMessage = 'å¤§æ–‡å­—ã¸ã®å¤‰æ›ãŒå®Œäº†ã—ã¾ã—ãŸã€‚';
        } else if (mode === 'htmlEscape') {
            // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ— (& < > " ' ã‚’å¤‰æ›)
            result = input.replace(/&/g, '&amp;')
                          .replace(/</g, '&lt;')
                          .replace(/>/g, '&gt;')
                          .replace(/"/g, '&quot;')
                          .replace(/'/g, '&#39;');
            successMessage = 'HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸã€‚';
        } else if (mode === 'htmlUnescape') {
            // HTMLã‚¢ãƒ³ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
            result = input.replace(/&lt;/g, '<')
                          .replace(/&gt;/g, '>')
                          .replace(/&quot;/g, '"')
                          .replace(/&#39;/g, "'")
                          .replace(/&amp;/g, '&');
            successMessage = 'HTMLã‚¢ãƒ³ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸã€‚';
        }
        
        resultTextarea.value = result;
        displayResult(formId, successMessage, false);

    } catch (e) {
        resultTextarea.value = '';
        displayResult(formId, `ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${e.message}`, true);
    }
}
</script>