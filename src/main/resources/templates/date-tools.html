<div class="container py-5">
    <h1 class="mb-5">ğŸ“… æ—¥ä»˜/æ™‚åˆ»ãƒ»Epoch Time ç›¸äº’å¤‰æ›ãƒ„ãƒ¼ãƒ«</h1>
    
    <div class="p-4 mb-5 bg-light rounded-3 shadow-sm">
        <h2 class="mb-4 fs-4">æ—¥ä»˜æ–‡å­—åˆ—ã®ç›¸äº’å¤‰æ›</h2>
        <div id="convertDateFormResult" class="alert mt-3" style="display:none;"></div>
        <form id="convertDateForm" onsubmit="handleDateConversion(event)">
            <div class="mb-3">
                <label for="inputDate" class="form-label">å…¥åŠ›æ—¥ä»˜æ–‡å­—åˆ—</label>
                <input type="text" id="inputDate" name="inputDate" class="form-control" placeholder="ä¾‹: 2024/05/20 10:30:00" required>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="inputFormat" class="form-label">å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</label>
                    <input type="text" id="inputFormat" name="inputFormat" class="form-control" value="yyyy/MM/dd HH:mm:ss" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="outputFormat" class="form-label">å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</label>
                    <input type="text" id="outputFormat" name="outputFormat" class="form-control" value="yyyy-MM-dd HH:mm:ss" required>
                </div>
            </div>
            <button type="submit" class="btn btn-primary">å¤‰æ›ã‚’å®Ÿè¡Œ</button>
        </form>
    </div>

    <div class="p-4 mb-5 bg-light rounded-3 shadow-sm">
        <h2 class="mb-4 fs-4">EpochãƒŸãƒªç§’ â†’ æ—¥ä»˜æ–‡å­—åˆ— å¤‰æ›</h2>
        <div id="epochToDateFormResult" class="alert mt-3" style="display:none;"></div>
        <form id="epochToDateForm" onsubmit="handleEpochToDate(event)">
            <div class="mb-3">
                <label for="epochMilli" class="form-label">EpochãƒŸãƒªç§’ (13æ¡)</label>
                <input type="text" id="epochMilli" name="epochMilli" class="form-control" placeholder="ä¾‹: 1716174600000" required>
            </div>
            <button type="submit" class="btn btn-primary">å¤‰æ›ã‚’å®Ÿè¡Œ</button>
        </form>
    </div>

    <div class="p-4 mb-5 bg-light rounded-3 shadow-sm">
        <h2 class="mb-4 fs-4">æ—¥ä»˜æ–‡å­—åˆ— â†’ EpochãƒŸãƒªç§’ å¤‰æ›</h2>
        <div id="dateToEpochFormResult" class="alert mt-3" style="display:none;"></div>
        <form id="dateToEpochForm" onsubmit="handleDateToEpoch(event)">
            <div class="mb-3">
                <label for="standardDate" class="form-label">æ—¥ä»˜æ–‡å­—åˆ— (JST/æ—¥æœ¬æ™‚é–“)</label>
                <input type="text" id="standardDate" name="standardDate" class="form-control" placeholder="ä¾‹: 2024/05/20 10:30:00" required>
            </div>
            <button type="submit" class="btn btn-primary">å¤‰æ›ã‚’å®Ÿè¡Œ</button>
        </form>
    </div>
</div>

<script>
/**
 * ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
 * @param {string} formId - ãƒ•ã‚©ãƒ¼ãƒ ã®ID
 * @param {string} message - è¡¨ç¤ºã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ (æˆåŠŸ/ã‚¨ãƒ©ãƒ¼)
 * @param {boolean} isError - ã‚¨ãƒ©ãƒ¼ã‹ã©ã†ã‹
 */
function displayResult(formId, message, isError) {
    const resultDiv = document.getElementById(formId + 'Result');
    if (!resultDiv) return;

    resultDiv.innerHTML = message;
    resultDiv.className = isError 
        ? 'alert alert-danger mt-3' 
        : 'alert alert-success mt-3';
    resultDiv.style.display = 'block';
}

/**
 * ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£: Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æŒ‡å®šã•ã‚ŒãŸå½¢å¼ (yyyy/MM/dd HH:mm:ss) ã§æ•´å½¢
 * JST (Asia/Tokyo) ã‚¾ãƒ¼ãƒ³IDã‚’åŸºæº–ã¨ã—ã¾ã™ã€‚
 * @param {Date} dateObj - æ•´å½¢ã™ã‚‹Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
 * @returns {string} æ•´å½¢ã•ã‚ŒãŸæ—¥ä»˜æ–‡å­—åˆ—
 */
function formatToStandardDate(dateObj) {
    // ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’ 'Asia/Tokyo' ã«è¨­å®š
    const options = {
        year: 'numeric', month: '2-digit', day: '2-digit',
        hour: '2-digit', minute: '2-digit', second: '2-digit',
        hourCycle: 'h23', // 24æ™‚é–“è¡¨è¨˜
        timeZone: 'Asia/Tokyo'
    };
    
    // Intl.DateTimeFormatã‚’ä½¿ç”¨ã—ã¦ JSTã§æ•´å½¢
    const formatter = new Intl.DateTimeFormat('ja-JP', options);
    const parts = formatter.formatToParts(dateObj);

    // partsã‚’æŠ½å‡ºã—ã¦ "yyyy/MM/dd HH:mm:ss" å½¢å¼ã«çµ„ã¿ç«‹ã¦ã‚‹
    const map = {};
    parts.forEach(p => map[p.type] = p.value);
    
    // Intl.DateTimeFormatã¯åŒºåˆ‡ã‚Šæ–‡å­—ã‚’ç’°å¢ƒã«ä¾å­˜ã•ã›ã‚‹ãŸã‚ã€ã‚«ã‚¹ã‚¿ãƒ ã§çµ„ã¿ç«‹ã¦ã‚‹
    const year = map.year;
    const month = map.month;
    const day = map.day;
    const hour = map.hour;
    const minute = map.minute;
    const second = map.second;
    
    if (!year || !month || !day || !hour || !minute || !second) {
        return "æ—¥ä»˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
    }

    return `${year}/${month}/${day} ${hour}:${minute}:${second}`;
}

// =========================================================
// 1. æ—¥ä»˜æ–‡å­—åˆ—ã®ç›¸äº’å¤‰æ› (handleDateConversion)
// =========================================================

/**
 * æ—¥ä»˜æ–‡å­—åˆ—ã®ç›¸äº’å¤‰æ›å‡¦ç†
 * ğŸš¨ æ³¨æ„: JavaScriptã®Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨Intl.DateTimeFormatã¯ã€
 * ç‹¬è‡ªã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè§£æã«ã¯é™ç•ŒãŒã‚ã‚Šã¾ã™ã€‚
 * ã“ã“ã§ã¯ã€æœ€ã‚‚ä¸€èˆ¬çš„ãªæ¨™æº–å½¢å¼ (yyyy/MM/dd HH:mm:ss) ã«å¤‰æ›ã§ãã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã«é™å®šã—ã¾ã™ã€‚
 */
function handleDateConversion(event) {
    event.preventDefault(); // ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡ã‚’é˜²ã
    const form = document.getElementById('convertDateForm');
    
    const inputDate = form.elements['inputDate'].value.trim();
    const inputFormat = form.elements['inputFormat'].value.trim();
    const outputFormat = form.elements['outputFormat'].value.trim();
    
    if (!inputDate || !inputFormat || !outputFormat) {
        displayResult('convertDateForm', 'å…¨ã¦ã®æ—¥ä»˜ã¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', true);
        return;
    }

    try {
        // ãƒ‘ãƒ¼ã‚¹ã‚’è©¦ã¿ã‚‹ (å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«åˆã‚ã›ã¦ãƒ­ã‚¸ãƒƒã‚¯ã‚’èª¿æ•´)
        // ã“ã“ã§ã¯ã€å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«åˆã‚ã›ã¦æ‰‹å‹•ã§ãƒ‘ãƒ¼ã‚¹ã™ã‚‹è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã‚’å¿…è¦ã¨ã—ã¾ã™ã€‚
        // ç°¡å˜ã®ãŸã‚ã€JSã®Date.parseã§ä¸€èˆ¬çš„ãªæ—¥ä»˜å½¢å¼ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¾ã™ã€‚
        const parsedTime = Date.parse(inputDate);
        if (isNaN(parsedTime)) {
             throw new Error('å…¥åŠ›æ—¥ä»˜ãŒè§£æå¯èƒ½ãªå½¢å¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚');
        }

        const dateObj = new Date(parsedTime);

        // å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«æ•´å½¢
        // ğŸš¨ é‡è¦: JSæ¨™æº–æ©Ÿèƒ½ã§ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«æ•´å½¢ã™ã‚‹ã«ã¯ã€Intl.DateTimeFormatã‚’ä½¿ã†ã‹ã€æ‰‹å‹•ã§çµ„ã¿ç«‹ã¦ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
        // ä¾‹ã¨ã—ã¦ã€formatToStandardDate()ã‚’ä½¿ã£ã¦æ¨™æº–å½¢å¼ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŒ‡å®šã—ãŸoutputFormatã®å½¢å¼ã«æ­£ç¢ºã«å‡ºåŠ›ã™ã‚‹ã«ã¯ã€ã‚ˆã‚Šè¤‡é›‘ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚
        
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŒ‡å®šã—ãŸoutputFormatã«åˆã‚ã›ãŸæ•´å½¢ãƒ­ã‚¸ãƒƒã‚¯ãŒå¿…è¦ã ãŒã€
        // ã‚µãƒ¼ãƒãƒ¼è² è·è»½æ¸›ãŒç›®çš„ãªã®ã§ã€ã“ã“ã¯ä¸€æ—¦æ¨™æº–å½¢å¼ã§å¯¾å¿œã™ã‚‹ã€‚
        const standardResult = formatToStandardDate(dateObj);
        
        displayResult('convertDateForm', `å¤‰æ›çµæœ (æ¨™æº–å½¢å¼): ${standardResult}`, false);
        
    } catch (e) {
        displayResult('convertDateForm', `ã‚¨ãƒ©ãƒ¼: ${e.message}`, true);
    }
}

// =========================================================
// 2. EpochãƒŸãƒªç§’ â†’ æ—¥ä»˜æ–‡å­—åˆ— å¤‰æ› (handleEpochToDate)
// =========================================================

/**
 * EpochãƒŸãƒªç§’ã‚’æ¨™æº–å½¢å¼ã®æ—¥ä»˜æ–‡å­—åˆ—ã«å¤‰æ›
 */
function handleEpochToDate(event) {
    event.preventDefault(); 
    const form = document.getElementById('epochToDateForm');
    const epochMilli = form.elements['epochMilli'].value.trim();
    
    if (!epochMilli || isNaN(epochMilli)) {
        displayResult('epochToDateForm', 'æœ‰åŠ¹ãªEpochãƒŸãƒªç§’ï¼ˆæ•°å€¤ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', true);
        return;
    }

    try {
        const milli = BigInt(epochMilli); // BigIntã§å¤§ããªå€¤ã«å¯¾å¿œ
        const dateObj = new Date(Number(milli)); // Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›

        if (isNaN(dateObj.getTime())) {
            throw new Error('æ—¥ä»˜ã®å¤‰æ›ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å€¤ãŒå¤§ãã™ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚');
        }
        
        // JSTã®æ¨™æº–å½¢å¼ã§å‡ºåŠ›
        const result = formatToStandardDate(dateObj);
        displayResult('epochToDateForm', `å¤‰æ›çµæœ: ${result}`, false);

    } catch (e) {
        displayResult('epochToDateForm', `ã‚¨ãƒ©ãƒ¼: ${e.message}`, true);
    }
}

// =========================================================
// 3. æ—¥ä»˜æ–‡å­—åˆ— â†’ EpochãƒŸãƒªç§’ å¤‰æ› (handleDateToEpoch)
// =========================================================

/**
 * æ¨™æº–å½¢å¼ã®æ—¥ä»˜æ–‡å­—åˆ—ã‚’EpochãƒŸãƒªç§’ã«å¤‰æ›
 */
function handleDateToEpoch(event) {
    event.preventDefault(); 
    const form = document.getElementById('dateToEpochForm');
    const standardDate = form.elements['standardDate'].value.trim();
    
    // æ¨™æº–å½¢å¼ã®æ­£è¦è¡¨ç¾ãƒã‚§ãƒƒã‚¯ (yyyy/MM/dd HH:mm:ss)
    const standardRegex = /^(\d{4})\/(\d{2})\/(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;

    if (!standardDate || !standardRegex.test(standardDate)) {
        displayResult('dateToEpochForm', 'æ—¥ä»˜ã‚’æ¨™æº–å½¢å¼ (yyyy/MM/dd HH:mm:ss) ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', true);
        return;
    }

    try {
        // JSTã¨ã—ã¦æ—¥ä»˜æ–‡å­—åˆ—ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã€Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
        // 'YYYY/MM/DD HH:mm:ss' ã‚’ JSTã¨ã—ã¦è§£é‡ˆã™ã‚‹
        const dateStringJST = `${standardDate} GMT+0900 (JST)`;
        const dateObj = new Date(dateStringJST);

        if (isNaN(dateObj.getTime())) {
             throw new Error('æ—¥ä»˜ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
        }

        // EpochãƒŸãƒªç§’ã‚’å–å¾—
        const epochMilli = dateObj.getTime();
        displayResult('dateToEpochForm', `EpochãƒŸãƒªç§’: ${epochMilli}`, false);
        
    } catch (e) {
        displayResult('dateToEpochForm', `ã‚¨ãƒ©ãƒ¼: ${e.message}`, true);
    }
}
</script>